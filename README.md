# M5ATOM-S3-CAN-KEY-PAD

M5Atom S3を使用したCAN通信キーパッドシステムです。
Web Bluetooth APIを使用しているため、専用アプリのインストールは不要で、スマートフォンのブラウザから直接CAN信号を送信して機器を制御できます。

## 📱 Webアプリ (コントローラー)
以下のURLにアクセスして使用します。
https://gok555.github.io/M5ATOM-S3-CAN-KEY-PAD/

## 📂 ファームウェアの種類
用途に合わせて、以下のフォルダ内のプログラムをM5Atom S3に書き込んでください。

### 1. M5 ATOM S3 1M SPEED ONLY CAN
* **通信速度:** 1Mbps 固定
* 通信速度が決まっている場合や、シンプルな構成で使用する場合に適しています。

### 2. M5 ATOM S3 AUTO CAN SPEED ver
* **通信速度:** 自動切替 (500kbps / 1Mbps)
* 接続先のCAN通信速度に合わせて、**500kbps または 1Mbps のいずれかに**自動的に切り替わります。
* ※その他の速度には対応していませんのでご注意ください。

---

## ⚙️ 設定・カスタマイズ (Configuration)

### CAN IDについて
* デフォルトの送信CAN IDは **100** に設定されています。

### IDを変更する場合
送信IDを変更したい場合は、以下の**2箇所**のプログラム内の数値を書き換える必要があります。
プログラム内には該当箇所にメモ書き（コメント）が記載されていますので、そちらを参考に変更してください。

1. **Webブラウザアプリ側** (`index.html`)
2. **M5Atom S3側プログラム** (`.ino`ファイル)

> [!NOTE]
> 両方のIDが一致していないと、正しく通信（制御）ができませんのでご注意ください。

---

## 🛠 使用ハードウェア (Hardware Requirements)

### 1. メインコントローラー
* **M5Stack ATOM S3**
    * 本システムの核となるデバイスです。
    * ディスプレイにIPアドレスや接続ステータス、送信中のCAN IDなどを表示します。

### 2. CAN通信モジュール
* **M5Stack Unit CAN Iso v2 (SKU: U085)**
    * 絶縁型CANトランシーバーユニット（CA-IS3050G搭載）です。
    * DC-DC絶縁電源を内蔵しており、車両からのノイズ干渉を防ぎ安全に通信できます。
    * ATOM S3のGroveポート(Port A)に接続して使用します。

### 3. 配線・その他
* **Groveケーブル:** ATOM S3とCAN Unitの接続用
* **CANバス接続ケーブル:** 車両のOBDIIコネクタやCANライン(CAN High / CAN Low)への接続用
* **USB Type-Cケーブル:** 給電および書き込み用

## ⚡ 接続について
* **CAN High / Low:** 車両側のCAN H/Lに合わせて
